# ----------------------------------------------
# âš™ï¸ Kubernetes Deployment for Node.js Backend
# ----------------------------------------------
apiVersion: apps/v1              # ğŸ§  This tells Kubernetes we are defining a Deployment
kind: Deployment
metadata:
  name: sustainat-backend        # ğŸ“› Unique name for this deployment
  namespace: sustainat           # ğŸ“¦ It belongs to the "sustainat" namespace (must be created first!)
  labels:
    app: sustainat-backend       # ğŸ·ï¸ Label used for selecting this app later in services

spec:
  replicas: 1                    # ğŸ‘¶ We are starting with 1 pod (instance) of backend
  selector:
    matchLabels:
      app: sustainat-backend     # ğŸ¯ This label MUST match the pod's label below

  template:                      # ğŸ“¦ Template used to create the backend pod
    metadata:
      labels:
        app: sustainat-backend   # âœ… Pod gets labeled as "sustainat-backend"
    spec:
      containers:
        - name: sustainat-backend                 # ğŸ³ Name of the container inside the pod
          image: sustainatltd/sustainat-project-server:latest  # ğŸ“¥ Pull this image from Docker Hub
          imagePullPolicy: Always                 # ğŸ” Always pull the latest image when restarting

          ports:
            - containerPort: 5001                 # ğŸšª Port the backend app is listening on (server.js)

          env:                                    # ğŸŒ¿ Define environment variables for the app
            - name: MONGO_URI                     # ğŸ“¡ Tells backend how to connect to MongoDB
              value: mongodb://sustainat-mongo:27017/sustainat

            - name: JWT_SECRET                    # ğŸ” Secret key used to sign JWT tokens (keep safe!)
              value: thisisasecretkey
