# -------------------------------
# âš™ï¸ Deployment for Node.js Backend
# -------------------------------
apiVersion: apps/v1              # ğŸ§  This tells Kubernetes it's a Deployment type
kind: Deployment
metadata:
  name: sustainat-backend        # ğŸ“› Name of our deployment
  namespace: sustainat           # ğŸ“¦ Deploy in the "sustainat" namespace
  labels:
    app: sustainat-backend       # ğŸ·ï¸ Label to match selectors later

spec:
  replicas: 1                    # ğŸ‘¶ Just 1 backend pod is enough for now
  selector:
    matchLabels:
      app: sustainat-backend     # ğŸ¯ This should match pod labels exactly below

  template:                      # ğŸ§ª This is the pod template
    metadata:
      labels:
        app: sustainat-backend   # âœ… Same label for pod
    spec:
      containers:
        - name: sustainat-backend
          image: sustainatltd/sustainat-project-server:latest  # ğŸ³ Docker image from Docker Hub
          imagePullPolicy: Always       # ğŸ” Always pull latest image

          ports:
            - containerPort: 5001       # ğŸšª This is where backend listens (from server.js)

          env:                          # ğŸŒ± Environment variables
            - name: MONGO_URI           # ğŸ”Œ MongoDB connection string
              value: mongodb://sustainat-mongo:27017/sustainat

            - name: JWT_SECRET          # ğŸ” Secret used to sign JWT tokens
              value: thisisasecretkey

